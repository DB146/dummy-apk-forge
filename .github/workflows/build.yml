name: Build Multiple Apps

on: [push, workflow_dispatch]

jobs:
  build-all:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'
          
      - name: Make Gradlew Executable
        run: chmod +x gradlew

      - name: Build APKs from List
        run: |
          mkdir -p build_output
          
          # Loop through packages.txt
          while IFS= read -r package_name || [ -n "$package_name" ]; do
            # Skip empty lines
            if [ -z "$package_name" ]; then continue; fi
            
            echo "----------------------------------------"
            echo "Building for: $package_name"
            echo "----------------------------------------"
            
            # Run Gradle, passing the package name as a parameter (appId)
            ./gradlew :app:assembleRelease -PappId="$package_name"
            
            # Move and rename the APK
            mv app/build/outputs/apk/release/app-release.apk "build_output/${package_name}.apk"
            
            # Clean for next build (optional, but safer)
            ./gradlew clean
            
          done < packages.txt

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: Generated-APKs
          path: build_output/*.apk
